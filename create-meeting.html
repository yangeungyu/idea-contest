<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>새 모임 만들기 - 무화과</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable.min.css" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            'sans': ['Pretendard Variable', 'Pretendard', '-apple-system', 'BlinkMacSystemFont', 'system-ui', 'Roboto', 'Helvetica Neue', 'Segoe UI', 'Apple SD Gothic Neo', 'Noto Sans KR', 'Malgun Gothic', 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'sans-serif']
          }
        }
      }
    }
  </script>
  <style>
    body { padding-top: 0px; }
    .form-section { margin-bottom: 2rem; }
    .form-group { margin-bottom: 1rem; }
    .required { color: #dc2626; }
    
    /* Pinterest 스타일 Masonry Grid */
    .masonry-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 16px;
      padding: 0;
      justify-content: start;
    }
    
    @media (min-width: 640px) {
      .masonry-grid {
        grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
        gap: 18px;
        padding: 0;
      }
    }
    
    @media (min-width: 1024px) {
      .masonry-grid {
        grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
        gap: 20px;
      }
    }
    
    @media (min-width: 1280px) {
      .masonry-grid {
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      }
    }
    
    .masonry-item {
      break-inside: avoid;
      margin-bottom: 20px;
    }
  </style>
</head>
<body class="bg-gray-50 lg:ml-20" data-page="create-meeting">

  <!-- 모임 상세 정보 모달 -->
  <div id="meetingDetailModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
      <!-- 모달 헤더 -->
      <div class="sticky top-0 bg-white border-b border-gray-200 p-6 rounded-t-xl">
        <div class="flex justify-between items-center">
          <h2 class="text-2xl font-bold text-gray-900">모임 상세 정보</h2>
          <button id="closeMeetingDetailModal" class="text-gray-400 hover:text-gray-600 transition-colors" onclick="closeMeetingDetailModal()">
            <span class="material-icons text-2xl">close</span>
          </button>
        </div>
      </div>

      <!-- 모달 내용 -->
      <div id="meetingDetailContent" class="p-6">
        <!-- 로딩 상태 -->
        <div id="meetingDetailLoading" class="text-center py-12">
          <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-[#6B4E71] mx-auto mb-4"></div>
          <p class="text-gray-500">모임 정보를 불러오는 중...</p>
        </div>

        <!-- 모임 상세 정보 -->
        <div id="meetingDetailInfo" class="hidden">
          <!-- 이미지 -->
          <div class="mb-6">
            <img id="meetingDetailImage" src="" alt="" class="w-full h-64 object-cover rounded-lg">
          </div>

          <!-- 기본 정보 -->
          <div class="mb-6">
            <div class="flex items-center justify-between mb-4">
              <span id="meetingDetailCategory" class="px-3 py-1 rounded-full text-sm font-medium"></span>
              <span id="meetingDetailDate" class="text-gray-500"></span>
            </div>
            <h3 id="meetingDetailTitle" class="text-2xl font-bold text-gray-900 mb-3"></h3>
            <p id="meetingDetailDescription" class="text-gray-600 leading-relaxed"></p>
          </div>

          <!-- 상세 정보 그리드 -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
            <!-- 참가자 정보 -->
            <div class="bg-gray-50 rounded-lg p-4">
              <div class="flex items-center mb-2">
                <span class="material-icons text-[#6B4E71] mr-2">people</span>
                <h4 class="font-semibold text-gray-900">참가자</h4>
              </div>
              <p id="meetingDetailMembers" class="text-gray-600"></p>
            </div>

            <!-- 모임 방식 -->
            <div class="bg-gray-50 rounded-lg p-4">
              <div class="flex items-center mb-2">
                <span class="material-icons text-[#6B4E71] mr-2">location_on</span>
                <h4 class="font-semibold text-gray-900">모임 방식</h4>
              </div>
              <p id="meetingDetailType" class="text-gray-600"></p>
            </div>

            <!-- 스터디 시작일 -->
            <div class="bg-gray-50 rounded-lg p-4">
              <div class="flex items-center mb-2">
                <span class="material-icons text-[#6B4E71] mr-2">event</span>
                <h4 class="font-semibold text-gray-900">스터디 시작일</h4>
              </div>
              <p id="meetingDetailStartDate" class="text-gray-600"></p>
            </div>

            <!-- 장소 -->
            <div class="bg-gray-50 rounded-lg p-4">
              <div class="flex items-center mb-2">
                <span class="material-icons text-[#6B4E71] mr-2">place</span>
                <h4 class="font-semibold text-gray-900">장소</h4>
              </div>
              <p id="meetingDetailLocation" class="text-gray-600"></p>
            </div>

            <!-- 스터디 종료일 -->
            <div class="bg-gray-50 rounded-lg p-4">
              <div class="flex items-center mb-2">
                <span class="material-icons text-[#6B4E71] mr-2">event_available</span>
                <h4 class="font-semibold text-gray-900">스터디 종료일</h4>
              </div>
              <p id="meetingDetailDeadline" class="text-gray-600"></p>
            </div>

            <!-- 모임 시간 -->
            <div class="bg-gray-50 rounded-lg p-4">
              <div class="flex items-center mb-2">
                <span class="material-icons text-[#6B4E71] mr-2">access_time</span>
                <h4 class="font-semibold text-gray-900">모임 시간</h4>
              </div>
              <p id="meetingDetailTime" class="text-gray-600"></p>
            </div>

            <!-- 모임 주기 -->
            <div class="bg-gray-50 rounded-lg p-4">
              <div class="flex items-center mb-2">
                <span class="material-icons text-[#6B4E71] mr-2">repeat</span>
                <h4 class="font-semibold text-gray-900">모임 주기</h4>
              </div>
              <p id="meetingDetailFrequency" class="text-gray-600"></p>
            </div>
          </div>

          <!-- 참가 조건/요구사항 -->
          <div id="meetingDetailRequirementsSection" class="mb-6">
            <h4 class="font-semibold text-gray-900 mb-3 flex items-center">
              <span class="material-icons text-[#6B4E71] mr-2">rule</span>
              참가 조건/요구사항
            </h4>
            <div class="bg-blue-50 rounded-lg p-4">
              <p id="meetingDetailRequirements" class="text-gray-700"></p>
            </div>
          </div>

          <!-- 참가자 목록 -->
          <div class="mb-6">
            <h4 class="font-semibold text-gray-900 mb-3 flex items-center">
              <span class="material-icons text-[#6B4E71] mr-2">group</span>
              참가자 목록
            </h4>
            <div id="meetingDetailMembersList" class="space-y-2">
              <!-- 참가자들이 여기에 표시됩니다 -->
            </div>
          </div>

          <!-- 태그 -->
          <div id="meetingDetailTagsSection" class="mb-6 hidden">
            <h4 class="font-semibold text-gray-900 mb-3 flex items-center">
              <span class="material-icons text-[#6B4E71] mr-2">label</span>
              태그
            </h4>
            <div id="meetingDetailTags" class="flex flex-wrap gap-2">
              <!-- 태그들이 여기에 표시됩니다 -->
            </div>
          </div>

          <!-- 액션 버튼 -->
          <div class="flex justify-between items-center pt-6 border-t border-gray-200">
            <!-- 리더 전용 버튼 (왼쪽) -->
            <div id="leaderActions" class="flex space-x-3 hidden">
              <button id="editMeetingBtn" class="px-4 py-2 border border-blue-300 text-blue-700 rounded-lg hover:bg-blue-50 transition-colors">
                <span class="material-icons text-sm mr-1">edit</span>
                수정
              </button>
              <button id="deleteMeetingBtn" class="px-4 py-2 border border-red-300 text-red-700 rounded-lg hover:bg-red-50 transition-colors">
                <span class="material-icons text-sm mr-1">delete</span>
                삭제
              </button>
            </div>
            
            <!-- 일반 버튼 (오른쪽) -->
            <div class="flex space-x-3 ml-auto">
              <button id="closeMeetingDetailBtn" class="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors" onclick="closeMeetingDetailModal()">
                닫기
              </button>
              <button id="joinMeetingBtn" class="px-6 py-2 bg-[#6B4E71] text-white rounded-lg hover:bg-[#5A3D5F] transition-colors">
                참가하기
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 메인 콘텐츠 -->
  <main class="pl-4 pr-4">
    <div class="max-w-7xl ml-0 mr-auto">
      <!-- 모임 목록 화면 -->
      <div id="meetingListView" class="max-w-7xl ml-0 mr-auto">
        <!-- 상단 검색 영역 (Pinterest 스타일) -->
        <div class="sticky top-0 bg-gray-50 z-10 py-6 mb-8">
          <div class="flex items-center gap-4">
            <!-- 검색 및 필터 -->
            <div class="flex-1 flex items-center gap-3">
              <div class="flex-1 relative">
                <input type="text" id="searchInput" placeholder="모임 검색..." 
                       class="w-full px-4 py-3 border border-gray-200 rounded-full focus:outline-none focus:ring-2 focus:ring-[#6B4E71] focus:border-transparent pl-12 bg-white shadow-sm"
                       oninput="filterMeetings()" onkeyup="filterMeetings()">
                <span class="material-icons absolute left-4 top-3.5 text-gray-400 text-xl">search</span>
              </div>
              
              <select id="categoryFilter" class="px-4 py-3 border border-gray-200 rounded-full focus:outline-none focus:ring-2 focus:ring-[#6B4E71] bg-white min-w-[140px] shadow-sm" onchange="filterMeetings()">
                <option value="">모든 카테고리</option>
                <option value="study">스터디</option>
                <option value="hobby">취미</option>
                <option value="exercise">운동</option>
                <option value="culture">문화</option>
                <option value="volunteer">봉사</option>
                <option value="networking">네트워킹</option>
                <option value="other">기타</option>
              </select>
            </div>
            
            <!-- 새 모임 만들기 버튼 (Pinterest 스타일) -->
            <button id="createNewMeetingBtn" class="bg-[#6B4E71] hover:bg-[#5A3D5F] text-white w-12 h-12 rounded-full flex items-center justify-center shadow-lg transition-all duration-200 hover:scale-105" onclick="showCreateForm()" title="새 모임 만들기">
              <span class="material-icons text-xl">add</span>
            </button>
          </div>
        </div>
        
        <!-- 모임 목록 (Pinterest 스타일) -->
        <div id="meetingList" class="masonry-grid">
          <!-- 모임들이 여기에 동적으로 로드됩니다 -->
          <div class="text-center py-12 text-gray-500 w-full col-span-full">
            <span class="material-icons text-4xl mb-2">event_note</span>
            <p>등록된 모임이 없습니다.</p>
          </div>
        </div>
        
        <!-- 페이지네이션 (동적으로 생성) -->
        <div id="pagination" class="flex justify-center hidden">
          <!-- 페이지네이션이 필요할 때만 표시 -->
        </div>
      </div>

    <!-- 모임 생성 폼 (처음에는 숨김) -->
    <div id="meetingFormView" class="max-w-4xl mx-auto hidden">
      <!-- 뒤로가기 버튼 -->
      <div class="mb-6">
        <button id="backToListBtn" class="flex items-center text-gray-600 hover:text-gray-800">
          <span class="material-icons mr-2">arrow_back</span>
          모임 목록으로 돌아가기
        </button>
      </div>
      
      <!-- 페이지 설명 -->
      <div class="bg-white p-6 rounded-lg shadow-md mb-8">
        <div class="flex items-center mb-4">
          <span class="material-icons text-[#6B4E71] text-3xl mr-3">event</span>
          <div>
            <h2 class="text-2xl font-bold text-gray-800">새로운 모임을 만들어보세요</h2>
            <p class="text-gray-600 mt-1">다양한 사람들과 함께할 수 있는 모임을 개설하고 관리할 수 있습니다.</p>
          </div>
        </div>
      </div>

      <!-- 모임 생성 폼 -->
      <form id="createMeetingForm" class="bg-white p-8 rounded-lg shadow-md">
        <!-- 기본 정보 섹션 -->
        <div class="form-section">
          <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
            <span class="material-icons text-[#6B4E71] mr-2">info</span>
            기본 정보
          </h3>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="form-group">
              <label for="meetingTitle" class="block text-sm font-medium text-gray-700 mb-2">
                모임 제목 <span class="required">*</span>
              </label>
              <input type="text" id="meetingTitle" name="title" required
                     class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#6B4E71] focus:border-[#6B4E71]"
                     placeholder="예: 홍천 독서 모임">
            </div>
            
            <div class="form-group">
              <label for="meetingCategory" class="block text-sm font-medium text-gray-700 mb-2">
                카테고리 <span class="required">*</span>
              </label>
              <select id="meetingCategory" name="category" required
                      class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#6B4E71] focus:border-[#6B4E71]">
                <option value="">카테고리 선택</option>
                <option value="study">스터디</option>
                <option value="hobby">취미</option>
                <option value="exercise">운동</option>
                <option value="culture">문화</option>
                <option value="volunteer">봉사</option>
                <option value="networking">네트워킹</option>
                <option value="other">기타</option>
              </select>
            </div>
          </div>
          
          <div class="form-group">
            <label for="meetingDescription" class="block text-sm font-medium text-gray-700 mb-2">
              모임 설명 <span class="required">*</span>
            </label>
            <textarea id="meetingDescription" name="description" rows="4" required
                      class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#6B4E71] focus:border-[#6B4E71]"
                      placeholder="모임에 대한 자세한 설명을 작성해주세요..."></textarea>
          </div>
          
          <!-- 이미지 업로드 섹션 -->
          <div class="form-group">
            <label class="block text-sm font-medium text-gray-700 mb-2">
              모임 대표 이미지
            </label>
            <div class="space-y-4">
              <!-- 파일 업로드 -->
              <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-green-400 transition-colors">
                <input type="file" id="meetingImage" name="image" accept="image/*" class="hidden" onchange="handleImageUpload(event)">
                <div id="uploadArea" class="cursor-pointer" onclick="document.getElementById('meetingImage').click()">
                  <span class="material-icons text-4xl text-gray-400 mb-2">cloud_upload</span>
                  <p class="text-gray-600 mb-1">클릭하여 이미지 업로드</p>
                  <p class="text-sm text-gray-400">JPG, PNG, GIF 파일 지원 (최대 5MB)</p>
                </div>
              </div>
              
              <!-- 또는 구분선 -->
              <div class="flex items-center">
                <div class="flex-1 border-t border-gray-300"></div>
                <span class="px-3 text-sm text-gray-500">또는</span>
                <div class="flex-1 border-t border-gray-300"></div>
              </div>
              
              <!-- Picsum 예시 이미지 선택 -->
              <div>
                <p class="text-sm text-gray-600 mb-3">아래 예시 이미지 중 선택하세요:</p>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                  <div class="relative cursor-pointer border-2 border-transparent rounded-lg overflow-hidden hover:border-green-500 transition-colors" onclick="selectPicsumImage('https://picsum.photos/seed/meeting1/400/300')">
                    <img src="https://picsum.photos/seed/meeting1/400/300" alt="예시 이미지 1" class="w-full h-20 object-cover">
                    <div class="absolute inset-0 bg-black bg-opacity-0 hover:bg-opacity-20 transition-opacity flex items-center justify-center">
                      <span class="material-icons text-white opacity-0 hover:opacity-100">check_circle</span>
                    </div>
                  </div>
                  <div class="relative cursor-pointer border-2 border-transparent rounded-lg overflow-hidden hover:border-green-500 transition-colors" onclick="selectPicsumImage('https://picsum.photos/seed/meeting2/400/300')">
                    <img src="https://picsum.photos/seed/meeting2/400/300" alt="예시 이미지 2" class="w-full h-20 object-cover">
                    <div class="absolute inset-0 bg-black bg-opacity-0 hover:bg-opacity-20 transition-opacity flex items-center justify-center">
                      <span class="material-icons text-white opacity-0 hover:opacity-100">check_circle</span>
                    </div>
                  </div>
                  <div class="relative cursor-pointer border-2 border-transparent rounded-lg overflow-hidden hover:border-green-500 transition-colors" onclick="selectPicsumImage('https://picsum.photos/seed/meeting3/400/300')">
                    <img src="https://picsum.photos/seed/meeting3/400/300" alt="예시 이미지 3" class="w-full h-20 object-cover">
                    <div class="absolute inset-0 bg-black bg-opacity-0 hover:bg-opacity-20 transition-opacity flex items-center justify-center">
                      <span class="material-icons text-white opacity-0 hover:opacity-100">check_circle</span>
                    </div>
                  </div>
                  <div class="relative cursor-pointer border-2 border-transparent rounded-lg overflow-hidden hover:border-green-500 transition-colors" onclick="selectPicsumImage('https://picsum.photos/seed/meeting4/400/300')">
                    <img src="https://picsum.photos/seed/meeting4/400/300" alt="예시 이미지 4" class="w-full h-20 object-cover">
                    <div class="absolute inset-0 bg-black bg-opacity-0 hover:bg-opacity-20 transition-opacity flex items-center justify-center">
                      <span class="material-icons text-white opacity-0 hover:opacity-100">check_circle</span>
                    </div>
                  </div>
                  <div class="relative cursor-pointer border-2 border-transparent rounded-lg overflow-hidden hover:border-green-500 transition-colors" onclick="selectPicsumImage('https://picsum.photos/seed/meeting5/400/300')">
                    <img src="https://picsum.photos/seed/meeting5/400/300" alt="예시 이미지 5" class="w-full h-20 object-cover">
                    <div class="absolute inset-0 bg-black bg-opacity-0 hover:bg-opacity-20 transition-opacity flex items-center justify-center">
                      <span class="material-icons text-white opacity-0 hover:opacity-100">check_circle</span>
                    </div>
                  </div>
                  <div class="relative cursor-pointer border-2 border-transparent rounded-lg overflow-hidden hover:border-green-500 transition-colors" onclick="selectPicsumImage('https://picsum.photos/seed/meeting6/400/300')">
                    <img src="https://picsum.photos/seed/meeting6/400/300" alt="예시 이미지 6" class="w-full h-20 object-cover">
                    <div class="absolute inset-0 bg-black bg-opacity-0 hover:bg-opacity-20 transition-opacity flex items-center justify-center">
                      <span class="material-icons text-white opacity-0 hover:opacity-100">check_circle</span>
                    </div>
                  </div>
                  <div class="relative cursor-pointer border-2 border-transparent rounded-lg overflow-hidden hover:border-green-500 transition-colors" onclick="selectPicsumImage('https://picsum.photos/seed/meeting7/400/300')">
                    <img src="https://picsum.photos/seed/meeting7/400/300" alt="예시 이미지 7" class="w-full h-20 object-cover">
                    <div class="absolute inset-0 bg-black bg-opacity-0 hover:bg-opacity-20 transition-opacity flex items-center justify-center">
                      <span class="material-icons text-white opacity-0 hover:opacity-100">check_circle</span>
                    </div>
                  </div>
                  <div class="relative cursor-pointer border-2 border-transparent rounded-lg overflow-hidden hover:border-green-500 transition-colors" onclick="selectPicsumImage('https://picsum.photos/seed/meeting8/400/300')">
                    <img src="https://picsum.photos/seed/meeting8/400/300" alt="예시 이미지 8" class="w-full h-20 object-cover">
                    <div class="absolute inset-0 bg-black bg-opacity-0 hover:bg-opacity-20 transition-opacity flex items-center justify-center">
                      <span class="material-icons text-white opacity-0 hover:opacity-100">check_circle</span>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- 선택된 이미지 미리보기 -->
              <div id="imagePreview" class="hidden">
                <p class="text-sm text-gray-600 mb-2">선택된 이미지:</p>
                <div class="relative inline-block">
                  <img id="previewImage" src="" alt="미리보기" class="w-32 h-24 object-cover rounded-lg border border-gray-300">
                  <button type="button" onclick="clearSelectedImage()" class="absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs hover:bg-red-600">
                    <span class="material-icons text-sm">close</span>
                  </button>
                </div>
              </div>
            </div>
            <input type="hidden" id="selectedImageUrl" name="imageUrl" value="">
          </div>
        </div>

        <!-- 일정 정보 섹션 -->
        <div class="form-section">
          <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
            <span class="material-icons text-[#6B4E71] mr-2">schedule</span>
            일정 정보
          </h3>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="form-group">
              <label for="startDate" class="block text-sm font-medium text-gray-700 mb-2">
                스터디 시작일 <span class="required">*</span>
              </label>
              <input type="date" id="startDate" name="startDate" required
                     class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#6B4E71] focus:border-[#6B4E71]">
            </div>
            
            <div class="form-group">
              <label for="endDate" class="block text-sm font-medium text-gray-700 mb-2">
                스터디 종료일 <span class="required">*</span>
              </label>
              <input type="date" id="endDate" name="endDate" required
                     class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#6B4E71] focus:border-[#6B4E71]">
            </div>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="form-group">
              <label for="meetingTime" class="block text-sm font-medium text-gray-700 mb-2">
                모임 시간
              </label>
              <input type="time" id="meetingTime" name="time"
                     class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#6B4E71] focus:border-[#6B4E71]">
            </div>
            
            <div class="form-group">
              <label for="frequency" class="block text-sm font-medium text-gray-700 mb-2">
                모임 주기
              </label>
              <select id="frequency" name="frequency"
                      class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#6B4E71] focus:border-[#6B4E71]">
                <option value="once">일회성</option>
                <option value="weekly">매주</option>
                <option value="biweekly">격주</option>
                <option value="monthly">매월</option>
                <option value="irregular">비정기</option>
              </select>
            </div>
          </div>
        </div>

        <!-- 장소 정보 섹션 -->
        <div class="form-section">
          <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
            <span class="material-icons text-[#6B4E71] mr-2">location_on</span>
            장소 정보
          </h3>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="form-group">
              <label for="meetingType" class="block text-sm font-medium text-gray-700 mb-2">
                모임 형태 <span class="required">*</span>
              </label>
              <select id="meetingType" name="meetingType" required
                      class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#6B4E71] focus:border-[#6B4E71]">
                <option value="">선택해주세요</option>
                <option value="offline">오프라인</option>
                <option value="online">온라인</option>
                <option value="both">혼합형</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="maxMembers" class="block text-sm font-medium text-gray-700 mb-2">
                최대 인원 <span class="required">*</span>
              </label>
              <input type="number" id="maxMembers" name="maxMembers" min="2" max="20" required
                     class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#6B4E71] focus:border-[#6B4E71]"
                     placeholder="2">
            </div>
          </div>
          
          <div class="form-group">
            <label for="location" class="block text-sm font-medium text-gray-700 mb-2">
              장소/링크
            </label>
            <input type="text" id="location" name="location"
                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#6B4E71] focus:border-[#6B4E71]"
                   placeholder="오프라인: 구체적인 주소 / 온라인: 화상회의 링크">
          </div>
        </div>

        <!-- 추가 정보 섹션 -->
        <div class="form-section">
          <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
            <span class="material-icons text-[#6B4E71] mr-2">settings</span>
            추가 설정
          </h3>
          
          <div class="form-group">
            <label for="tags" class="block text-sm font-medium text-gray-700 mb-2">
              태그 (쉼표로 구분)
            </label>
            <input type="text" id="tags" name="tags"
                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#6B4E71] focus:border-[#6B4E71]"
                   placeholder="예: 독서, 토론, 자기계발">
          </div>
          
          <div class="form-group">
            <label for="requirements" class="block text-sm font-medium text-gray-700 mb-2">
              참가 조건/요구사항
            </label>
            <textarea id="requirements" name="requirements" rows="3"
                      class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#6B4E71] focus:border-[#6B4E71]"
                      placeholder="모임 참가를 위한 특별한 조건이나 준비물이 있다면 작성해주세요..."></textarea>
          </div>
          
        </div>

        <!-- 제출 버튼 -->
        <div class="flex justify-end space-x-4 pt-6 border-t border-gray-200">
          <button type="button" onclick="history.back()" 
                  class="px-6 py-2 text-gray-700 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors">
            취소
          </button>
          <button type="submit" 
                  class="px-6 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors flex items-center">
            <span class="material-icons mr-2">add</span>
            모임 만들기
          </button>
        </div>
      </form>
    </div>
  </div>
  </main>


  <style>
    .dropdown:hover .dropdown-menu {
      display: block !important;
    }
    
    .dropdown-menu {
      min-width: 160px;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      border: 1px solid #e5e7eb;
    }
  </style>

  <script>
    // 전역 변수로 현재 사용자 정보 저장
    let currentUser = null;

    // 페이지 로드 시 즉시 로그인 확인
    (async function() {
      try {
        const response = await fetch('/api/current-user', {
          credentials: 'include'
        });
        const data = await response.json();
        
        if (!data.isAuthenticated) {
          alert('로그인이 필요한 페이지입니다.');
          window.location.href = 'login.html';
          return;
        }
        
        // 현재 사용자 정보 저장
        currentUser = data.user;
        
        // 로그인 상태 표시 (헤더가 제거되어 주석 처리)
        // document.getElementById('auth-buttons').style.display = 'none';
        // document.getElementById('userMenu').classList.remove('hidden');
        // document.getElementById('userName').textContent = data.user.name || data.user.username;
        
        // 모임 목록 로드
        loadMeetings();
        
        // 버튼 이벤트 리스너 - DOM 로드 후 실행 (onclick으로 대체됨)
        setTimeout(() => {
          const backBtn = document.getElementById('backToListBtn');
          const createForm = document.getElementById('createMeetingForm');
          
          if (backBtn) backBtn.addEventListener('click', showMeetingList);
          if (createForm) createForm.addEventListener('submit', handleCreateMeeting);
        }, 100);
        
        // 오늘 날짜를 최소값으로 설정 - DOM 로드 후 실행
        setTimeout(() => {
          const today = new Date().toISOString().split('T')[0];
          const startDateInput = document.getElementById('startDate');
          const endDateInput = document.getElementById('endDate');
          
          if (startDateInput) {
            startDateInput.min = today;
            // 시작일 변경 시 스터디 종료일 최소값 업데이트
            startDateInput.addEventListener('change', function() {
              if (endDateInput) {
                endDateInput.min = this.value;
              }
            });
          }
          if (endDateInput) {
            endDateInput.min = today;
          }
        }, 100);
        
      } catch (error) {
        console.error('인증 확인 오류:', error);
        window.location.href = 'login.html';
      }
    })();

    // 모임 생성 처리
    async function handleCreateMeeting(e) {
      e.preventDefault();
      
      const formData = new FormData(e.target);
      const meetingData = {};
      
      // 폼 데이터 수집
      for (let [key, value] of formData.entries()) {
        if (key === 'tags') {
          meetingData[key] = value.split(',').map(tag => tag.trim()).filter(tag => tag);
        } else {
          meetingData[key] = value;
        }
      }
      
      
      // 이미지 처리
      const selectedImageUrl = document.getElementById('selectedImageUrl').value;
      const imageFile = document.getElementById('meetingImage').files[0];
      
      if (imageFile) {
        // 파일이 업로드된 경우 - 서버에 업로드하여 영구 저장
        const imageFormData = new FormData();
        imageFormData.append('image', imageFile);
        
        try {
          const imageResponse = await fetch('/api/upload-image', {
            method: 'POST',
            credentials: 'include',
            body: imageFormData
          });
          
          if (imageResponse.ok) {
            const imageData = await imageResponse.json();
            meetingData.imageUrl = imageData.imageUrl;
          } else {
            console.error('이미지 업로드 실패');
            // 업로드 실패 시 기본 이미지 사용
            meetingData.imageUrl = 'https://picsum.photos/400/300?random=' + Date.now();
          }
        } catch (error) {
          console.error('이미지 업로드 오류:', error);
          meetingData.imageUrl = 'https://picsum.photos/400/300?random=' + Date.now();
        }
      } else if (selectedImageUrl && selectedImageUrl.includes('picsum.photos')) {
        // Picsum 이미지가 선택된 경우 - 선택된 URL 그대로 사용 (이미 seed 포함)
        meetingData.imageUrl = selectedImageUrl;
      } else if (selectedImageUrl) {
        meetingData.imageUrl = selectedImageUrl;
      } else {
        // 기본 이미지 - 모임 제목을 시드로 사용
        const titleSeed = meetingData.title ? meetingData.title.replace(/\s+/g, '') : 'default';
        meetingData.imageUrl = `https://picsum.photos/seed/${titleSeed}/400/300`;
      }
      
      // meetingType 필드는 이미 올바른 이름으로 설정됨
      
      // 필수 필드 검증
      const requiredFields = ['title', 'description', 'category', 'startDate', 'meetingType', 'maxMembers'];
      for (const field of requiredFields) {
        if (!meetingData[field]) {
          alert(`${field} 필드가 누락되었습니다.`);
          return;
        }
      }
      
      // 숫자 필드 변환 및 유효성 검사
      if (meetingData.maxMembers) {
        meetingData.maxMembers = parseInt(meetingData.maxMembers);
        if (meetingData.maxMembers > 20) {
          alert('최대 인원은 20명을 초과할 수 없습니다.');
          return;
        }
        if (meetingData.maxMembers < 2) {
          alert('최대 인원은 최소 2명 이상이어야 합니다.');
          return;
        }
      }
      if (meetingData.duration) {
        meetingData.duration = parseInt(meetingData.duration);
      }
      
      // deadline 필드 추가 (스터디 종료일 1주 전을 모집 마감일로 설정)
      if (meetingData.endDate) {
        const endDate = new Date(meetingData.endDate);
        endDate.setDate(endDate.getDate() - 7); // 종료일 1주 전을 모집 마감일로
        meetingData.deadline = endDate.toISOString().split('T')[0];
      } else {
        // endDate가 없으면 startDate + 3주를 모집 마감일로 설정
        const startDate = new Date(meetingData.startDate);
        startDate.setDate(startDate.getDate() + 21); // 3주 후
        meetingData.deadline = startDate.toISOString().split('T')[0];
      }
      
      // duration 필드 추가 (기본값 4주)
      if (!meetingData.duration) {
        meetingData.duration = 4;
      }
      
      // 현재 사용자를 리더로 설정 (서버에서 처리하도록 단순화)
      // meetingData.currentMembers는 서버에서 자동으로 설정됨
      
      let response;
      try {
        response = await fetch('/api/studies', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          credentials: 'include',
          body: JSON.stringify(meetingData)
        });
        
        const data = await response.json();
        
        if (!response.ok) {
          console.error('서버 응답:', data);
          throw new Error(data.message || '모임 생성에 실패했습니다.');
        }
        
        alert('모임이 성공적으로 생성되었습니다!');
        showMeetingList(); // 목록으로 돌아가기
        
      } catch (error) {
        console.error('모임 생성 오류:', error);
        console.error('전송된 데이터:', meetingData);
        if (response) {
          console.error('응답 상태:', response.status);
        }
        alert(error.message || '모임 생성 중 오류가 발생했습니다.');
      }
    }

    // 전역 변수로 모든 모임 데이터 저장
    let allMeetings = [];

    // 모임 목록 로드
    async function loadMeetings() {
      try {
        const response = await fetch('/api/studies', {
          credentials: 'include'
        });
        const data = await response.json();
        allMeetings = data.studies || data;
        renderMeetings(allMeetings);
        
        // 로드 완료 후 URL 검색어 처리
        const urlParams = new URLSearchParams(window.location.search);
        const searchQuery = urlParams.get('search');
        
        if (searchQuery) {
          const searchInput = document.getElementById('searchInput');
          if (searchInput) {
            searchInput.value = searchQuery;
            filterMeetings(); // 검색 실행
          }
        }
      } catch (error) {
        console.error('모임 목록 로드 오류:', error);
      }
    }

    // 모임 목록 렌더링 (Pinterest 스타일)
    function renderMeetings(meetings) {
      const meetingList = document.getElementById('meetingList');
      const pagination = document.getElementById('pagination');
      
      if (!meetings || meetings.length === 0) {
        meetingList.innerHTML = `
          <div class="col-span-full text-center py-16 text-gray-500">
            <span class="material-icons text-5xl mb-4 text-gray-300">event_note</span>
            <p class="text-lg">등록된 모임이 없습니다.</p>
            <p class="text-sm mt-2">새로운 모임을 만들어보세요!</p>
          </div>
        `;
        pagination.classList.add('hidden');
        return;
      }
      
      // 모임이 있으면 페이지네이션 숨김 (현재는 단순 목록)
      pagination.classList.add('hidden');
      
      meetingList.innerHTML = meetings.map((meeting, index) => {
        const categoryColors = {
          'study': 'bg-blue-100 text-blue-800',
          'hobby': 'bg-purple-100 text-purple-800',
          'exercise': 'bg-red-100 text-red-800',
          'culture': 'bg-yellow-100 text-yellow-800',
          'volunteer': 'bg-green-100 text-green-800',
          'networking': 'bg-indigo-100 text-indigo-800',
          'other': 'bg-gray-100 text-gray-800'
        };
        
        const categoryTexts = {
          'study': '스터디',
          'hobby': '취미',
          'exercise': '운동',
          'culture': '문화',
          'volunteer': '봉사',
          'networking': '네트워킹',
          'other': '기타'
        };
        
        const startDate = new Date(meeting.startDate).toLocaleDateString('ko-KR');
        
        // 이미지 URL 결정 (저장된 이미지가 있으면 사용, 없으면 모임 ID를 시드로 사용)
        const imageUrl = meeting.imageUrl || `https://picsum.photos/seed/${meeting._id}/300/200`;
        
        return `
          <div class="masonry-item bg-white rounded-2xl shadow-sm hover:shadow-lg transition-all duration-300 overflow-hidden group cursor-pointer" onclick="openMeetingDetail('${meeting._id}')">
            <!-- 이미지 섹션 -->
            <div class="relative overflow-hidden">
              <img src="${imageUrl}" alt="${meeting.title}" class="w-full h-40 object-cover group-hover:scale-105 transition-transform duration-500">
              <div class="absolute top-2 left-2">
                <span class="px-2 py-1 rounded-full text-xs font-semibold bg-white/90 backdrop-blur-sm text-gray-700 shadow-sm">
                  ${categoryTexts[meeting.category] || '기타'}
                </span>
              </div>
              <div class="absolute top-2 right-2">
                <div class="bg-black/20 backdrop-blur-sm rounded-full px-2 py-1">
                  <span class="text-xs text-white font-medium">${startDate}</span>
                </div>
              </div>
              <!-- 그라데이션 오버레이 -->
              <div class="absolute inset-0 bg-gradient-to-t from-black/20 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
            </div>
            
            <!-- 콘텐츠 섹션 -->
            <div class="p-4">
              <h3 class="text-base font-bold text-gray-900 mb-2 line-clamp-2 group-hover:text-green-600 transition-colors leading-tight">${meeting.title}</h3>
              <p class="text-gray-600 text-sm mb-3 line-clamp-2 leading-relaxed">${meeting.description}</p>
              
              <!-- 메타 정보 -->
              <div class="flex items-center justify-between text-xs text-gray-500 mb-3">
                <div class="flex items-center space-x-2">
                  <span class="flex items-center">
                    <span class="material-icons text-sm mr-1">people</span>
                    ${meeting.currentMembers?.length || 0}/${meeting.maxMembers}
                  </span>
                  <span class="flex items-center">
                    <span class="material-icons text-sm mr-1">
                      ${meeting.meetingType === 'online' ? 'computer' : meeting.meetingType === 'offline' ? 'place' : 'hub'}
                    </span>
                    ${meeting.meetingType === 'online' ? '온라인' : meeting.meetingType === 'offline' ? '오프라인' : '혼합형'}
                  </span>
                </div>
              </div>
              
              <!-- 참가 버튼 -->
              <button class="w-full bg-[#6B4E71] hover:bg-[#5A3D5F] text-white py-2 rounded-lg text-sm font-medium transition-all duration-200 hover:scale-[1.02] active:scale-[0.98]" onclick="event.stopPropagation(); joinMeeting('${meeting._id}')">
                참가하기
              </button>
            </div>
          </div>
        `;
      }).join('');
    }

    // 모임 상세 정보 모달 열기
    async function openMeetingDetail(meetingId) {
      const modal = document.getElementById('meetingDetailModal');
      const loading = document.getElementById('meetingDetailLoading');
      const info = document.getElementById('meetingDetailInfo');
      
      // 모달 열기 및 로딩 상태 표시
      modal.classList.remove('hidden');
      loading.classList.remove('hidden');
      info.classList.add('hidden');
      
      try {
        // API에서 모임 상세 정보 가져오기
        const response = await fetch(`/api/studies/${meetingId}`, {
          credentials: 'include'
        });
        
        if (!response.ok) {
          throw new Error('모임 정보를 불러올 수 없습니다.');
        }
        
        const meeting = await response.json();
        displayMeetingDetail(meeting);
        
      } catch (error) {
        console.error('모임 상세 정보 로드 오류:', error);
        alert('모임 정보를 불러오는 중 오류가 발생했습니다.');
        closeMeetingDetailModal();
      }
    }
    
    // 모임 상세 정보 표시
    function displayMeetingDetail(meeting) {
      const categoryColors = {
        'study': 'bg-blue-100 text-blue-800',
        'hobby': 'bg-purple-100 text-purple-800',
        'exercise': 'bg-red-100 text-red-800',
        'culture': 'bg-yellow-100 text-yellow-800',
        'volunteer': 'bg-green-100 text-green-800',
        'networking': 'bg-indigo-100 text-indigo-800',
        'other': 'bg-gray-100 text-gray-800'
      };
      
      const categoryTexts = {
        'study': '스터디',
        'hobby': '취미',
        'exercise': '운동',
        'culture': '문화',
        'volunteer': '봉사',
        'networking': '네트워킹',
        'other': '기타'
      };
      
      // 이미지 설정
      const imageUrl = meeting.imageUrl || `https://picsum.photos/seed/${meeting._id}/600/300`;
      document.getElementById('meetingDetailImage').src = imageUrl;
      document.getElementById('meetingDetailImage').alt = meeting.title;
      
      // 카테고리 설정
      const categoryElement = document.getElementById('meetingDetailCategory');
      categoryElement.textContent = categoryTexts[meeting.category] || '기타';
      categoryElement.className = `px-3 py-1 rounded-full text-sm font-medium ${categoryColors[meeting.category] || categoryColors.other}`;
      
      // 기본 정보 설정
      document.getElementById('meetingDetailDate').textContent = new Date(meeting.startDate).toLocaleDateString('ko-KR');
      document.getElementById('meetingDetailTitle').textContent = meeting.title;
      document.getElementById('meetingDetailDescription').textContent = meeting.description;
      
      // 상세 정보 설정
      document.getElementById('meetingDetailMembers').textContent = `${meeting.currentMembers?.length || 0}명 / ${meeting.maxMembers}명`;
      document.getElementById('meetingDetailType').textContent = meeting.meetingType === 'online' ? '온라인' : meeting.meetingType === 'offline' ? '오프라인' : '온/오프라인 혼합형';
      
      // 스터디 시작일
      const startDate = new Date(meeting.startDate);
      document.getElementById('meetingDetailStartDate').textContent = startDate.toLocaleDateString('ko-KR');
      
      // 스터디 종료일
      const endDateForDeadline = meeting.endDate ? new Date(meeting.endDate) : new Date(meeting.deadline);
      document.getElementById('meetingDetailDeadline').textContent = endDateForDeadline.toLocaleDateString('ko-KR');
      
      // 모임 시간
      const timeText = meeting.time ? meeting.time : '미정';
      document.getElementById('meetingDetailTime').textContent = timeText;
      
      // 모임 주기
      const frequencyTexts = {
        'once': '일회성',
        'weekly': '매주',
        'biweekly': '격주',
        'monthly': '매월',
        'irregular': '비정기'
      };
      const frequencyText = meeting.frequency ? frequencyTexts[meeting.frequency] || meeting.frequency : '미정';
      document.getElementById('meetingDetailFrequency').textContent = frequencyText;
      
      // 태그 표시
      const tagsSection = document.getElementById('meetingDetailTagsSection');
      const tagsContainer = document.getElementById('meetingDetailTags');
      if (meeting.tags && meeting.tags.length > 0) {
        tagsSection.classList.remove('hidden');
        tagsContainer.innerHTML = meeting.tags.map(tag => 
          `<span class="px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm">#${tag}</span>`
        ).join('');
      } else {
        tagsSection.classList.add('hidden');
      }
      
      // 참가 조건/요구사항 표시 (항상 표시)
      const requirementsText = document.getElementById('meetingDetailRequirements');
      if (meeting.requirements && meeting.requirements.trim()) {
        requirementsText.textContent = meeting.requirements;
      } else {
        requirementsText.textContent = '특별한 참가 조건이나 요구사항이 없습니다.';
      }
      
      // 장소/링크 정보 개선
      let locationText = meeting.location || '미정';
      if (meeting.meetingType === 'online' && !meeting.location) {
        locationText = '온라인 (링크는 참가 후 공개)';
      }
      document.getElementById('meetingDetailLocation').textContent = locationText;
      
      // 참가자 목록 표시 (리더 확인)
      const membersList = document.getElementById('meetingDetailMembersList');
      let isCurrentUserLeader = false;
      
      if (meeting.currentMembers && meeting.currentMembers.length > 0) {
        membersList.innerHTML = meeting.currentMembers.map(member => {
          // 현재 사용자가 리더인지 확인
          if (member.isLeader && currentUser && (member.username === currentUser.username || member._id === currentUser._id)) {
            isCurrentUserLeader = true;
          }
          
          return `
            <div class="flex items-center space-x-3 p-2 bg-white rounded-lg border border-gray-200">
              <div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center">
                <span class="material-icons text-green-600 text-sm">person</span>
              </div>
              <span class="text-gray-900">${member.name || member.username}</span>
              ${member.isLeader ? '<span class="text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full">리더</span>' : ''}
            </div>
          `;
        }).join('');
      } else {
        membersList.innerHTML = '<p class="text-gray-500 text-center py-4">아직 참가자가 없습니다.</p>';
      }
      
      // 리더 권한 버튼 표시/숨김
      const leaderActions = document.getElementById('leaderActions');
      if (isCurrentUserLeader) {
        leaderActions.classList.remove('hidden');
        
        // 수정 버튼 이벤트
        document.getElementById('editMeetingBtn').onclick = () => editMeeting(meeting._id);
        
        // 삭제 버튼 이벤트
        document.getElementById('deleteMeetingBtn').onclick = () => deleteMeeting(meeting._id);
      } else {
        leaderActions.classList.add('hidden');
      }
      
      // 참가하기 버튼 설정
      const joinBtn = document.getElementById('joinMeetingBtn');
      joinBtn.onclick = () => joinMeetingFromModal(meeting._id);
      
      // 로딩 숨기고 정보 표시
      document.getElementById('meetingDetailLoading').classList.add('hidden');
      document.getElementById('meetingDetailInfo').classList.remove('hidden');
    }
    
    // 모달에서 모임 참가하기
    async function joinMeetingFromModal(meetingId) {
      try {
        const response = await fetch(`/api/studies/${meetingId}/join`, {
          method: 'POST',
          credentials: 'include'
        });
        
        if (!response.ok) {
          throw new Error('참가 신청에 실패했습니다.');
        }
        
        alert('모임 참가 신청이 완료되었습니다!');
        closeMeetingDetailModal();
        loadMeetings(); // 목록 새로고침
        
      } catch (error) {
        console.error('모임 참가 오류:', error);
        alert('참가 신청 중 오류가 발생했습니다.');
      }
    }
    
    // 모임 수정
    function editMeeting(meetingId) {
      // TODO: 모임 수정 기능 구현
      alert('모임 수정 기능은 준비 중입니다.');
    }
    
    // 모임 삭제
    async function deleteMeeting(meetingId) {
      if (!confirm('정말로 이 모임을 삭제하시겠습니까?')) {
        return;
      }
      
      try {
        const response = await fetch(`/api/studies/${meetingId}`, {
          method: 'DELETE',
          credentials: 'include'
        });
        
        if (!response.ok) {
          throw new Error('모임 삭제에 실패했습니다.');
        }
        
        alert('모임이 삭제되었습니다.');
        closeMeetingDetailModal();
        loadMeetings(); // 목록 새로고침
        
      } catch (error) {
        console.error('모임 삭제 오류:', error);
        alert('모임 삭제 중 오류가 발생했습니다.');
      }
    }

    // 모임 상세 정보 모달 닫기
    function closeMeetingDetailModal() {
      document.getElementById('meetingDetailModal').classList.add('hidden');
    }

    // 모임 참가하기
    async function joinMeeting(meetingId) {
      try {
        const response = await fetch(`/api/studies/${meetingId}/join`, {
          method: 'POST',
          credentials: 'include'
        });
        
        const data = await response.json();
        
        if (!response.ok) {
          throw new Error(data.message || '모임 참가에 실패했습니다.');
        }
        
        alert('모임에 성공적으로 참가했습니다!');
        loadMeetings(); // 목록 새로고침
        
      } catch (error) {
        console.error('모임 참가 오류:', error);
        alert(error.message || '모임 참가 중 오류가 발생했습니다.');
      }
    }

    // 화면 전환 함수들
    function showCreateForm() {
      document.getElementById('meetingListView').classList.add('hidden');
      document.getElementById('meetingFormView').classList.remove('hidden');
    }

    function showMeetingList() {
      document.getElementById('meetingFormView').classList.add('hidden');
      document.getElementById('meetingListView').classList.remove('hidden');
      loadMeetings(); // 목록 새로고침
    }
    
    // 이미지 업로드 처리
    function handleImageUpload(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      // 파일 크기 체크 (5MB)
      if (file.size > 5 * 1024 * 1024) {
        alert('파일 크기는 5MB를 초과할 수 없습니다.');
        return;
      }
      
      // 파일 타입 체크
      if (!file.type.startsWith('image/')) {
        alert('이미지 파일만 업로드 가능합니다.');
        return;
      }
      
      const reader = new FileReader();
      reader.onload = function(e) {
        showImagePreview(e.target.result);
        document.getElementById('selectedImageUrl').value = e.target.result;
      };
      reader.readAsDataURL(file);
    }
    
    // Picsum 이미지 선택
    function selectPicsumImage(imageUrl) {
      // 이전 선택 해제
      document.querySelectorAll('.grid div').forEach(div => {
        div.classList.remove('border-green-500');
        div.classList.add('border-transparent');
      });
      
      // 현재 선택 표시
      event.currentTarget.classList.remove('border-transparent');
      event.currentTarget.classList.add('border-green-500');
      
      showImagePreview(imageUrl);
      document.getElementById('selectedImageUrl').value = imageUrl;
      
      // 파일 입력 초기화
      document.getElementById('meetingImage').value = '';
    }
    
    // 이미지 미리보기 표시
    function showImagePreview(imageSrc) {
      const previewDiv = document.getElementById('imagePreview');
      const previewImg = document.getElementById('previewImage');
      
      previewImg.src = imageSrc;
      previewDiv.classList.remove('hidden');
    }
    
    // 선택된 이미지 제거
    function clearSelectedImage() {
      document.getElementById('imagePreview').classList.add('hidden');
      document.getElementById('selectedImageUrl').value = '';
      document.getElementById('meetingImage').value = '';
      
      // Picsum 선택 해제
      document.querySelectorAll('.grid div').forEach(div => {
        div.classList.remove('border-green-500');
        div.classList.add('border-transparent');
      });
    }

    // 로그아웃 처리
    async function handleLogout() {
      try {
        const response = await fetch('/api/logout', {
          method: 'POST',
          credentials: 'include'
        });
        
        if (!response.ok) {
          throw new Error('로그아웃에 실패했습니다.');
        }
        
        alert('로그아웃되었습니다.');
        window.location.href = 'login.html';
      } catch (error) {
        console.error('로그아웃 오류:', error);
        alert('로그아웃 중 오류가 발생했습니다.');
      }
    }

    // 검색 및 필터링 기능
    function filterMeetings() {
      console.log('filterMeetings 함수 호출됨');
      
      // 모임 목록 화면이 보이는지 확인
      const meetingListView = document.getElementById('meetingListView');
      if (!meetingListView || meetingListView.classList.contains('hidden')) {
        console.log('모임 목록 화면이 숨겨져 있습니다.');
        return;
      }
      
      const searchInput = document.getElementById('searchInput');
      const categoryFilter = document.getElementById('categoryFilter');
      
      if (!searchInput) {
        console.log('검색 입력 요소를 찾을 수 없습니다.');
        return;
      }
      
      if (!categoryFilter) {
        console.log('카테고리 필터 요소를 찾을 수 없습니다.');
        return;
      }
      
      if (!allMeetings) {
        console.log('allMeetings가 정의되지 않았습니다.');
        return;
      }
      
      if (allMeetings.length === 0) {
        console.log('모임 데이터가 없습니다.');
        const meetingList = document.getElementById('meetingList');
        if (meetingList) {
          meetingList.innerHTML = `
            <div class="text-center py-12 text-gray-500 w-full">
              <span class="material-icons text-4xl mb-2">event_note</span>
              <p>등록된 모임이 없습니다.</p>
            </div>
          `;
        }
        return;
      }
      
      const searchTerm = searchInput.value.toLowerCase().trim();
      const selectedCategory = categoryFilter.value;
      
      console.log('검색어:', searchTerm, '카테고리:', selectedCategory, '전체 모임 수:', allMeetings.length);
      
      const filteredMeetings = allMeetings.filter(meeting => {
        const matchesSearch = !searchTerm || 
                             (meeting.title && meeting.title.toLowerCase().includes(searchTerm)) ||
                             (meeting.description && meeting.description.toLowerCase().includes(searchTerm)) ||
                             (meeting.tags && Array.isArray(meeting.tags) && meeting.tags.some(tag => tag.toLowerCase().includes(searchTerm)));
        const matchesCategory = !selectedCategory || meeting.category === selectedCategory;
        
        return matchesSearch && matchesCategory;
      });
      
      console.log('필터링된 모임 수:', filteredMeetings.length);
      renderMeetings(filteredMeetings);
    }

    // 페이지 로드 시 초기화
    document.addEventListener('DOMContentLoaded', function() {
      checkLoginStatus();
      loadMeetings();
      
      // URL에서 검색어 파라미터 확인
      const urlParams = new URLSearchParams(window.location.search);
      const searchQuery = urlParams.get('search');
      
      
      // HTML에 인라인 이벤트가 있으므로 추가 이벤트 리스너는 제거
      console.log('페이지 로드 완료 - 인라인 이벤트 사용');
      
      // 드롭다운 메뉴 토글
      document.addEventListener('click', function(e) {
        const dropdown = document.querySelector('.dropdown-menu');
        const userButton = document.querySelector('.dropdown-toggle');
        
        if (userButton && userButton.contains(e.target)) {
          dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none';
        } else {
          dropdown.style.display = 'none';
        }
      });
      
      // 모달 닫기 이벤트 리스너
      document.addEventListener('click', function(e) {
        // X 버튼 클릭
        if (e.target.id === 'closeMeetingDetailModal' || e.target.closest('#closeMeetingDetailModal')) {
          closeMeetingDetailModal();
        }
        // 닫기 버튼 클릭
        if (e.target.id === 'closeMeetingDetailBtn' || e.target.closest('#closeMeetingDetailBtn')) {
          closeMeetingDetailModal();
        }
        // 모달 배경 클릭 시 닫기
        if (e.target.id === 'meetingDetailModal') {
          closeMeetingDetailModal();
        }
      });
    });
  </script>
  <script src="common.js"></script>
  <script src="sidebar.js"></script>
  <script src="script.js"></script>
</body>
</html>
